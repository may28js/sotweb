# 后台管理系统权限升级规划 (Backend Permission System Roadmap)

## 1. 核心设计理念
从单一的 **等级制 (Level-based)** 向 **角色访问控制 (RBAC)** 过渡，保留 `AccessLevel` 作为基础分层，引入 `Permissions`（权限点）以实现更细粒度的控制。

## 2. 角色分级与职能定义

### Level 1: Moderator (版主/运营) - "内容维护者"
*   **核心职能**: 社区活跃维护，资讯发布，基础客服。
*   **权限模块**:
    *   **新闻管理**: 发布、编辑、删除新闻公告。
    *   **用户管理 (受限)**: 仅查询用户信息（用于解决卡死等问题），**无权**封号或修改资产。
    *   **工单系统**: 查看和回复用户咨询。
*   **敏感数据**: 用户敏感信息（IP、邮箱）需脱敏显示。

### Level 2: Admin (高级管理员/GM) - "系统管理者"
*   **核心职能**: 游戏生态平衡，违规处理，商业运营。
*   **权限模块**:
    *   **商店管理**: 商品上下架，价格调整（需强制审计日志）。
    *   **用户管理 (完全)**: 封禁/解封账号，处理严重违规。
    *   **游戏设置**: 修改服务器公告，调整非核心游戏参数。
    *   **日志审计**: 查看 Level 1 人员的操作记录。

### Level 3: Partner (合伙人/财务) - "数据观察者"
*   **核心职能**: 业务监控，财务分析，决策支持。
*   **权限模块**:
    *   **财务仪表盘**: 查看流水、ARPU、充值渠道占比等核心数据。
    *   **运营报表**: 留存率、活跃度趋势分析。
    *   **权限特性**: **全局只读 (Read-Only)**。通常无权进行修改操作，确保数据安全。

### Level 4: Owner (所有者) - "上帝视角"
*   **核心职能**: 权限分配，核心系统配置，安全兜底。
*   **权限模块**:
    *   **权限管理**: 授予/回收其他管理员权限（如任命版主、添加合伙人）。
    *   **系统配置**: 数据库连接、支付密钥等核心参数配置。
    *   **高级审计**: 监控 Level 2/3 人员的行为。
    *   **紧急熔断**: 一键锁定所有非 Owner 账号的后台访问权限。

## 3. 技术实现建议

### 前端 (Client)
*   **动态路由 (Dynamic Routing)**: 登录时由后端返回权限列表（如 `['news.edit', 'store.view']`），前端据此动态渲染侧边栏菜单，无权限的入口直接隐藏。
*   **UI 脱敏**: 根据权限等级，在前端组件中自动对敏感字段（手机号、邮箱）进行打码处理。

### 后端 (Server)
*   **权限点设计**: 在 API 层使用 Policy 或 Attribute 进行控制，例如 `[Authorize(Policy = "CanEditNews")]`。
*   **审计日志 (Audit Logs)**: 
    *   记录所有**写操作**（增删改）。
    *   格式示例: `[时间] [操作人ID] [模块] [动作] [原值 -> 新值]`。
*   **数据隔离**: 确保低权限管理员无法通过 API 遍历或导出全部高敏感数据。

## 4. 实施阶段规划
*   **Phase 1 (现状)**: 简单的 `AccessLevel` (0-3) 判断。
*   **Phase 2**: 引入审计日志，记录关键操作。
*   **Phase 3**: 实现“合伙人”只读视图和财务仪表盘。
*   **Phase 4**: 全面 RBAC 化，支持自定义角色和权限点分配。
