# 启动器与网站对接及数据互通备忘录

## 1. 核心原则
- **单一数据源 (Single Source of Truth)**: 启动器和网站共享同一个后端 (ASP.NET Core API) 和同一个数据库。不创建独立的数据孤岛。
- **接口复用**: 尽可能复用现有的 API 接口，通过参数区分客户端来源。

## 2. 新闻与内容分发策略 (平台差异化)
针对“部分内容仅在启动器显示，不在网站显示”的需求（如启动器更新日志、技术性公告）：

### 方案设计
1.  **后端 (Server)**:
    *   在 `NewsController` 中维护一个**屏蔽列表** (例如: `["启动器更新", "技术细节"]`)。
    *   修改 `GetNews` 接口，增加可选参数 `platform` (string)。
    *   **逻辑**:
        *   当请求参数为 `?platform=web` 时：后端查询数据库后，**自动剔除** 属于屏蔽列表分类的新闻。
        *   当请求参数为 `?platform=launcher` (或不传) 时：返回所有新闻。
2.  **前端 (Website)**:
    *   网站调用 API 时强制附带 `platform=web` 参数。
3.  **启动器 (Launcher)**:
    *   启动器调用 API 时不传参，或传 `platform=launcher`，即可获取包括“启动器更新”在内的所有数据。

## 3. 用户认证与互通 (Auth)
### 注册与登录
- **统一账户体系**: 启动器直接连接后端 `/api/auth` 相关接口。
- **登录流程**:
  1.  用户在启动器输入账号密码。
  2.  启动器发送 POST 请求到 `/api/auth/login`。
  3.  后端验证通过，返回 JWT Token。
  4.  启动器将 Token 安全存储（建议使用操作系统级的安全存储，如 Windows Credential Locker，或加密存在本地文件）。
- **会话保持**:
  - 启动器每次启动时，检查本地 Token 是否有效。
  - 所有后续 API 请求都在 HTTP Header 中携带 `Authorization: Bearer <Token>`。

## 4. 商店与积分系统实现
### 架构思路
- **纯 API 模式 (推荐)**:
  - 启动器作为纯客户端，负责 UI 绘制（商品列表、购买按钮、动效）。
  - 数据交互完全走 API：
    - `GET /api/shop/items`: 获取商品列表。
    - `GET /api/user/balance`: 获取用户当前积分/货币。
    - `POST /api/shop/buy`: 购买商品（后端负责校验余额、扣费、记录购买历史）。
- **混合模式 (WebView)**:
  - 如果商店页面非常复杂（包含大量活动页、复杂的排版），可以在启动器中嵌入 WebView。
  - 直接加载网站的商店页面，通过 URL 参数 (e.g., `?client=launcher`) 让网站隐藏顶部导航栏和页脚，只显示内容区。
  - **难点**: 需要处理 WebView 与启动器外壳的 Token 同步问题（Cookie vs Header）。

## 5. 启动器界面数据传输
- **模块化接口**: 建议为启动器首页开发聚合接口 (Aggregation API)。
  - 例如 `GET /api/launcher/home`。
  - 一次性返回：最新新闻（含隐藏分类）、服务器状态（在线/维护）、轮播图数据、当前版本号。
  - 减少启动器发起的 HTTP 请求数量，加快启动速度。

---
*创建日期: 2026-01-01*
*状态: 待实施*
