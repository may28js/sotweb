# StoryOfTime Launcher 开发规划与备忘录

**最后更新日期**: 2026-01-06
**状态**: 执行中 (Phase 1)

## 核心指导思想
**先逻辑后界面，先稳固后美化**
启动器不仅是下载器，更是**客户端环境管理器**。必须确保用户启动的永远是“标准、纯净、最新”的客户端。

---

## 阶段一：核心逻辑重构 (Game Core Logic)
*目标：构建健壮的客户端管理能力，解决非标准补丁和版本一致性问题。*

### Task 1: 基础设施准备 (Infrastructure)
- [ ] **定义 Manifest 数据结构**
  - 包含：文件相对路径、文件大小、MD5/SHA1 哈希值、文件类型 (核心/补丁/可选)。
- [ ] **后端 API 扩展**
  - 新增接口：返回服务器当前要求的标准文件清单 (Client Manifest)。
- [ ] **本地哈希工具 (HashCalculator)**
  - 实现高效的文件哈希计算方法 (用于大文件校验)。

### Task 2: 客户端管理逻辑 (Client Management)
- [ ] **导入现有游戏 (Client Import)**
  - 实现 `GameScanner`：扫描指定目录特征文件 (Wow.exe, Data/common.MPQ)。
  - 策略：采用“移动并接管”策略，确保环境隔离。
- [ ] **完整性校验与清洗 (Sanitation)**
  - 实现 `FileSanitizer`：
    - **白名单机制**：对比本地文件与服务器 Manifest。
    - **隔离策略**：将未知/非标准文件移入 `Quarantine` 文件夹 (非删除)。
    - **修复策略**：标记损坏或哈希不匹配的文件为“待下载”。
- [ ] **补丁更新机制 (Patching)**
  - 差异化更新：仅下载缺失或过期的补丁文件。
  - 启动前检查：每次启动前快速校验关键补丁。
  - 缓存清理：自动清理 WDB 缓存文件夹。

---

## 阶段二：界面交互优化 (UI/UX Refinement)
*目标：提升视觉质感，修复已知布局错误，统一交互体验。*

### Task 3: 商店页重构 (Store Page)
- [ ] **布局修复**
  - 使用 CSS Grid 重构商品列表，解决分辨率适配问题。
  - 修复价格和购买按钮的显示错位。
- [ ] **体验优化**
  - 引入图片懒加载 (Lazy Loading)。
  - 添加加载骨架屏 (Skeleton Screen)。

### Task 4: 全局视觉微调 (Visual Polish)
- [ ] **颜色体系标准化**
  - 统一背景色 (neutral-900 / 深蓝灰)。
  - 统一强调色 (按钮、进度条)。
- [ ] **状态反馈**
  - 按钮增加 Hover/Active/Disabled 状态样式。
  - 进度条增加具体文字说明 (如 "正在校验: common.MPQ (34%)")。
- [ ] **设置页升级**
  - 新增“导入游戏”入口。
  - 新增“修复客户端”手动触发按钮。

---

## 阶段三：联调与发布 (Integration & Release)
*目标：确保全流程无死角，达到发布标准。*

- [ ] **场景测试**
  - [ ] 场景 A: 全新安装 (下载 -> 解压 -> 启动)。
  - [ ] 场景 B: 导入“脏”客户端 (含私服补丁) -> 清洗 -> 启动。
  - [ ] 场景 C: 版本更新 (服务器发布新补丁 -> 客户端自动检测更新)。
- [ ] **自动化打包发布**
  - 完善 `publish.ps1` 脚本。
  - 最终真机测试。
